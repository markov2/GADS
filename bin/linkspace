#!/usr/bin/env perl
#
# This script wraps command-line features in a generic interface.  Put
# each of the components in lib/Linkspace/Command/*.pm files.

use warnings;
use strict;

use Log::Report 'linkspace';

#XXX Not needed when code gets installed for real, but required when
#XXX the code is only unpacked and used in-situ.
use lib 'lib', '../lib';

use Linkspace           ();
use Linkspace::Util     qw(scan_for_plugins);
use Linkspace::Commands ();

use Getopt::Long        qw(GetOptions);
use File::Basename      qw(basename);

my $program = basename $0;

if( ! @ARGV || $ARGV[0] eq '--help' || $ARGV[0] eq '-?')
{   Linkspace::Commands->global_help;
    exit 0;
}

my $config_fn = 'linkspace.yml';
if(@ARGV > 2 && ($ARGV[0] eq '--config' || $ARGV[0] eq '-c'))
{   $config_fn = $ARGV[1];
    splice @ARGV, 0, 2;
}

my $command = shift @ARGV;
$command !~ /^-/
    or error __x"Unknown global option '{option}'", option => $command;

Linkspace->start(
    config_fn => $config_fn,
);

# Errors to log-infra when not used interactive
-t or $::linkspace->start_logging;

my $cmds = Linkspace::Commands->new;

GetOptions
    'help|?!'  => \(my $cmd_help),
    ;


if($cmd_help)
{   $cmds->plugin_help($command);
    exit 0;
}

exit 0;
